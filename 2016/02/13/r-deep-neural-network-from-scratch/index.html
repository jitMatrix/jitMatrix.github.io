<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>R for Deep Learning (I):  Build Fully Connected Neural Network from Scratch | oneXPU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="BackgroundsDeep Neural Network (DNN) has made a great progress in recent years in image recognition, natural language processing and automatic driving fields, such as Picture.1 shown from 2012  to 201">
<meta property="og:type" content="article">
<meta property="og:title" content="R for Deep Learning (I):  Build Fully Connected Neural Network from Scratch">
<meta property="og:url" content="https://jitmatrix.github.io/oneXPU/2016/02/13/r-deep-neural-network-from-scratch/index.html">
<meta property="og:site_name" content="oneXPU">
<meta property="og:description" content="BackgroundsDeep Neural Network (DNN) has made a great progress in recent years in image recognition, natural language processing and automatic driving fields, such as Picture.1 shown from 2012  to 201">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/ces2016.png">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/matrureDNNPackages-2.png">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/dnn_architecture.png">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/neuron.png">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/iris_network.png">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/class.relu_.png">
<meta property="og:image" content="http://inside-r.org/r-doc/base/is.null">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/iris_loss_accuracy-1.png">
<meta property="og:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/tensorflow.png">
<meta property="article:published_time" content="2016-02-13T14:08:47.000Z">
<meta property="article:modified_time" content="2020-12-19T06:37:18.634Z">
<meta property="article:author" content="Patric Zhao">
<meta property="article:tag" content="rstats">
<meta property="article:tag" content="R">
<meta property="article:tag" content="deep learning">
<meta property="article:tag" content="machine learning">
<meta property="article:tag" content="dnn">
<meta property="article:tag" content="big data">
<meta property="article:tag" content="data analytics">
<meta property="article:tag" content="iris">
<meta property="article:tag" content="neural network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.parallelr.com/wp-content/uploads/2016/02/ces2016.png">
  
    <link rel="alternate" href="/oneXPU/atom.xml" title="oneXPU" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/oneXPU/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/oneXPU/css/style.css">

  
    
<link rel="stylesheet" href="/oneXPU/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/oneXPU/" id="logo">oneXPU</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/oneXPU/" id="subtitle">Diving into Parallel Technology</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/oneXPU/">Home</a>
        
          <a class="main-nav-link" href="/oneXPU/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/oneXPU/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jitmatrix.github.io/oneXPU"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-r-deep-neural-network-from-scratch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/oneXPU/2016/02/13/r-deep-neural-network-from-scratch/" class="article-date">
  <time class="dt-published" datetime="2016-02-13T14:08:47.000Z" itemprop="datePublished">2016-02-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/oneXPU/categories/General/">General</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      R for Deep Learning (I):  Build Fully Connected Neural Network from Scratch
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Backgrounds"><a href="#Backgrounds" class="headerlink" title="Backgrounds"></a>Backgrounds</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Deep_learning">Deep Neural Network (DNN)</a> has made a great progress in recent years in image recognition, natural language processing and automatic driving fields, such as Picture.1 shown from 2012  to 2015 DNN improved <a target="_blank" rel="noopener" href="http://image-net.org/challenges/LSVRC/2015/">IMAGNET</a>’s accuracy from ~80% to ~95%, which really beats traditional computer vision (CV) methods. <a target="_blank" rel="noopener" href="http://www.parallelr.com/wp-content/uploads/2016/02/ces2016.png"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/ces2016.png" alt="Jensen&#39;s CES2016 talk" title="From NVIDIA CEO Jensen&#39;s talk in CES16"></a></p>
<p>Picture.1 - <a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLZHnYvH1qtObAdk3waYMalhA8bdbhyTm2">From NVIDIA CEO Jensen’s talk in CES16</a></p>
<p>In this post, we will focus on fully connected neural networks which are commonly called DNN in data science. The biggest advantage of DNN is to extract and learn features automatically by deep layers architecture, especially for these complex and high-dimensional data that feature engineers can’t capture easily, examples in <a target="_blank" rel="noopener" href="http://blog.kaggle.com/2014/08/01/learning-from-the-best/">Kaggle</a>. Therefore, DNN is also very attractive to data scientists and there are lots of successful cases as well in classification, time series, and recommendation system, such as <a target="_blank" rel="noopener" href="http://blog.dominodatalab.com/using-r-h2o-and-domino-for-a-kaggle-competition/">Nick’s post</a> and <a target="_blank" rel="noopener" href="http://www.r-bloggers.com/using-neural-networks-for-credit-scoring-a-simple-example/">credit scoring</a> by DNN. In CRAN and R’s community, there are several popular and mature DNN packages including <a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/nnet/index.html">nnet</a>, <a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/neuralnet/">nerualnet</a>, <a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/h2o/index.html">H2O</a>, <a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/darch/index.html">DARCH</a>, <a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/deepnet/index.html">deepnet </a>and <a target="_blank" rel="noopener" href="https://github.com/dmlc/mxnet">mxnet</a>,  and I strong recommend <a target="_blank" rel="noopener" href="http://www.h2o.ai/verticals/algos/deep-learning/">H2O DNN algorithm and R interface</a>. <a target="_blank" rel="noopener" href="http://www.parallelr.com/wp-content/uploads/2016/02/matrureDNNPackages-2.png"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/matrureDNNPackages-2.png"></a>   So, <strong>why we need to build DNN from scratch at all?</strong> - Understand how neural network works Using existing DNN package, you only need one line R code for your DNN model in most of the time and there is <a target="_blank" rel="noopener" href="http://www.r-bloggers.com/fitting-a-neural-network-in-r-neuralnet-package/">an example</a> by neuralnet. For the inexperienced user, however, the processing and results may be difficult to understand.  Therefore, it will be a valuable practice to implement your own network in order to understand more details from mechanism and computation views. - Build specified network with your new ideas DNN is one of rapidly developing area. Lots of novel works and research results are published in the top journals and Internet every week, and the users also have their specified neural network configuration to meet their problems such as different activation functions, loss functions, regularization, and connected graph. On the other hand, the existing packages are definitely behind the latest researches, and almost all existing packages are written in C/C++, Java so it’s not flexible to apply latest changes and your ideas into the packages. - Debug and visualize network and data As we mentioned, the existing DNN package is highly assembled and written by low-level languages so that it’s a nightmare to debug the network layer by layer or node by node. Even it’s not easy to visualize the results in each layer, monitor the data or weights changes during training, and show the discovered patterns in the network.  </p>
<h2 id="Fundamental-Concepts-and-Components"><a href="#Fundamental-Concepts-and-Components" class="headerlink" title="Fundamental Concepts and Components"></a>Fundamental Concepts and Components</h2><p><a target="_blank" rel="noopener" href="http://lo.epfl.ch/files/content/sites/lo/files/shared/1990/IEEE_78_1637_Oct1990.pdf">Fully connected neural network</a>, called DNN in data science, is that adjacent network layers are fully connected to each other. Every neuron in the network is connected to every neuron in adjacent layers. A very simple and typical neural network is shown below with 1 input layer, 2 hidden layers, and 1 output layer. Mostly, when researchers talk about network’s architecture, it refers to the configuration of DNN, such as how many layers in the network, how many neurons in each layer, what kind of activation, loss function, and regularization are used. <a target="_blank" rel="noopener" href="http://www.parallelr.com/wp-content/uploads/2016/02/dnn_architecture.png"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/dnn_architecture.png" alt="arch"></a> Now, we will go through the basic components of DNN and show you how it is implemented in R. <strong>Weights and Bias</strong> Take above DNN architecture, for example, there are 3 groups of weights from the input layer to first hidden layer, first to second hidden layer and second hidden layer to output layer. Bias unit links to every hidden node and which affects the output scores, but without interacting with the actual data. In our R implementation, we represent weights and bias by the matrix. Weight size is defined by,</p>
<blockquote>
<p>  (number of neurons layer M) X (number of neurons in layer M+1)</p>
</blockquote>
<p>and weights are initialized by random number from rnorm. Bias is just a one dimension matrix with the same size of  neurons and set to zero. Other initialization approaches, such as calibrating the variances with 1/sqrt(n) and sparse initialization, are introduced in <a target="_blank" rel="noopener" href="http://cs231n.github.io/neural-networks-2/#init">weight initialization</a> part of Stanford CS231n. Pseudo R code:</p>
<p>weight.i &lt;- 0.01*<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/stats/rnorm">rnorm</a>(layer size of (i) * layer size of (i+1)),<br> <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=layer size of (i),<br> <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=layer size of (i+1))<br>bias.i    &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(0, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=1, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a> = layer size of (i+1))</p>
<p>Another common implementation approach combines weights and bias together so that the dimension of input is N+1 which indicates N input features with 1 bias, as below code:</p>
<p>weight   &lt;- 0.01*<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/stats/rnorm">rnorm</a>((layer size of (i) +1) * layer size of (i+1)),<br> <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=layer size of (i) +1,<br> <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=layer size of (i+1))</p>
<p><strong>Neuron</strong> A neuron is a basic unit in the DNN which is biologically inspired model of the human neuron. A single neuron performs weight and input multiplication and addition (FMA), which is as same as the linear regression in data science, and then FMA’s result is passed to the activation function. The commonly used activation functions include <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Sigmoid_function">sigmoid</a>, <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">ReLu</a>, <a target="_blank" rel="noopener" href="https://reference.wolfram.com/language/ref/Tanh.html">Tanh</a> and Maxout. In this post, I will take the rectified linear unit (ReLU)  as activation function,  <code>f(x) = max(0, x)</code>. For other types of activation function, you can refer <a target="_blank" rel="noopener" href="http://cs231n.github.io/neural-networks-1/#actfun">here</a>. <a target="_blank" rel="noopener" href="http://www.parallelr.com/wp-content/uploads/2016/02/neuron.png"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/neuron.png" alt="neuron"></a> In R, we can implement neuron by various methods, such as <code>sum(xi*wi)</code>. But, more efficient representation is by matrix multiplication. R code:</p>
<p>neuron.ij &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/max">max</a>(0, input %*% weight + bias)</p>
<p><strong><em>Implementation Tips</em></strong> <em>In practice, we always update all neurons in a layer with a batch of examples for performance consideration. Thus, the above code will not work correctly.</em> <em>1) Matrix Multiplication and Addition</em> <em>As below code shown,  <code>input %*% weights</code> and <code>bias</code> with different dimensions and  it can’t  be added directly. Two solutions are provided. The first one repeats bias</em> ncol <em>times, however, it will waste lots of memory in big data input. Therefore, the second approach is better.</em></p>
<p># dimension: 2X2<br>input &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(1:4, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=2, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=2)<br># dimension: 2x3<br>weights &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(1:6, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=2, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=3)<br># dimension: 1<em>3<br>bias &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(1:3, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=1, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=3)<br># doesn’t work since unmatched dimension<br>input %</em>% weights + bias<br>Error input %<em>% weights + bias : non-conformable arrays<br> <br># solution 1: repeat bias aligned to 2X3<br>s1 &lt;- input %</em>% weights + <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rep">rep</a>(bias, each=2), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=3)<br> <br># solution 2: sweep addition<br>s2 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(input %*% weights ,2, bias, ‘+’)<br> <br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/all.equal">all.equal</a>(s1, s2)<br>[1] TRUE</p>
<p><em>2) Element-wise max value for a matrix</em> <em>Another trick in here is to replace <code>max</code> by <code>pmax</code> to get element-wise maximum value instead of a global one, and be careful of the order in <code>pmax</code> :)</em></p>
<p># the original matrix<br>&gt; s1<br>     [,1] [,2] [,3]<br>[1,]    8   17   26<br>[2,]   11   24   37<br> <br># max returns global maximum<br>&gt; <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/max">max</a>(0, s1)<br>[1] 37<br> <br># s1 is aligned with a scalar, so the matrix structure is lost<br>&gt; <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/pmax">pmax</a>(0, s1)<br>[1]  8 11 17 24 26 37<br> <br># correct<br># put matrix in the first, the scalar will be recycled to match matrix structure<br>&gt; <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/pmax">pmax</a>(s1, 0)<br>     [,1] [,2] [,3]<br>[1,]    8   17   26<br>[2,]   11   24   37</p>
<p><strong>Layer</strong> - Input Layer the input layer is relatively fixed with only 1 layer and the unit number is equivalent to the number of features in the input data. -Hidden layers Hidden layers are very various and it’s the core component in DNN. But in general,  more hidden layers are needed to capture desired patterns in case the problem is more complex (non-linear). -Output Layer The unit in output layer most commonly does not have an activation because it is usually taken to represent the class scores in classification and arbitrary real-valued numbers in regression. For classification, the number of output units matches the number of categories of prediction while there is only one output node for regression.  </p>
<h2 id="Build-Neural-Network-Architecture-Prediction-and-Training"><a href="#Build-Neural-Network-Architecture-Prediction-and-Training" class="headerlink" title="Build Neural Network: Architecture, Prediction, and Training"></a>Build Neural Network: Architecture, Prediction, and Training</h2><p>Till now, we have covered the basic concepts of deep neural network and we are going to build a neural network now, which includes determining the network architecture, training network and then predict new data with the learned network. To make things simple, we use a small data set, Edgar Anderson’s Iris Data (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Iris_flower_data_set">iris</a>) to do classification by DNN. <strong>Network Architecture</strong> IRIS is well-known built-in dataset in stock R for machine learning. So you can take a look at this dataset by the <code>summary</code> at the console directly as below. R code:</p>
<p><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/summary">summary</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>)<br>  Sepal.Length    Sepal.Width     Petal.Length    Petal.Width          Species<br> Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100   setosa    :50<br> 1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300   versicolor:50<br> Median :5.800   Median :3.000   Median :4.350   Median :1.300   virginica :50<br> Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199<br> 3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800<br> Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500</p>
<p>From the summary, there are four features and three categories of Species. So we can design a DNN architecture as below. <a target="_blank" rel="noopener" href="http://www.parallelr.com/r-deep-neural-network-from-scratch/iris_network/"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/iris_network.png" alt="iris_network"></a>   And then we will keep our DNN model in a list, which can be used for retrain or prediction, as below. Actually, we can keep more interesting parameters in the model with great flexibility. R code:</p>
<p>List of 7<br> $ D : int 4<br> $ H : num 6<br> $ K : int 3<br> $ W1: num [1:4, 1:6] 1.34994 1.11369 -0.57346 -1.12123 -0.00107 …<br> $ b1: num [1, 1:6] 1.336621 -0.509689 -0.000277 -0.473194 0 …<br> $ W2: num [1:6, 1:3] 1.31464 -0.92211 -0.00574 -0.82909 0.00312 …<br> $ b2: num [1, 1:3] 0.581 0.506 -1.088</p>
<p><strong>Prediction</strong> Prediction, also called classification or inference in machine learning field, is concise compared with training, which walks through the network layer by layer from input to output by matrix multiplication. In output layer, the activation function doesn’t need. And for classification, the probabilities will be calculated by <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Softmax_function">softmax</a>  while for regression the output represents the real value of predicted.   This process is called feed forward or feed propagation. R code:</p>
<p># Prediction<br>predict.dnn &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/function">function</a>(model, data = X.test) {<br>  # new data, transfer to matrix<br>  new.data &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/data.matrix">data.matrix</a>(data)<br> <br>  # Feed Forwad<br>  hidden.layer &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(new.data %<em>% model$W1 ,2, model$b1, ‘+’)<br>  # neurons : Rectified Linear<br>  hidden.layer &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/pmax">pmax</a>(hidden.layer, 0)<br>  score &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(hidden.layer %</em>% model$W2, 2, model$b2, ‘+’)<br> <br>  # Loss Function: softmax<br>  score.exp &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/exp">exp</a>(score)<br>  probs &lt;-<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(score.exp, 1, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rowSums">rowSums</a>(score.exp), ‘/‘)<br> <br>  # select max possiblity<br>  labels.predicted &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/max.col">max.col</a>(probs)<br>  <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/return">return</a>(labels.predicted)<br>}</p>
<p><strong>Training</strong> Training is to search the optimization parameters (weights and bias) under the given network architecture and minimize the classification error or residuals.  This process includes two parts: feed forward and back propagation. Feed forward is going through the network with input data (as prediction parts) and then compute data loss in the output layer by <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Loss_function">loss function</a> (cost function). “<em>Data loss</em> measures the compatibility between a prediction (e.g. the class scores in classification) and the ground truth label.” In our example code, we selected cross-entropy function to evaluate data loss, see detail in <a target="_blank" rel="noopener" href="http://cs231n.github.io/neural-networks-2/#losses">here</a>. After getting data loss, we need to minimize the data loss by changing the weights and bias. The very popular method is to back-propagate the loss into every layers and neuron by <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Gradient_descent">gradient descent</a> or  <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Stochastic_gradient_descent">stochastic gradient descent</a> which requires derivatives of data loss for each parameter (W1, W2, b1, b2). And <a target="_blank" rel="noopener" href="http://colah.github.io/posts/2015-08-Backprop/">back propagation</a> will be different for different activation functions and see <a target="_blank" rel="noopener" href="http://mochajl.readthedocs.org/en/latest/user-guide/neuron.html">here</a> and <a target="_blank" rel="noopener" href="http://like.silk.to/studymemo/ChainRuleNeuralNetwork.pdf">here</a> for their derivatives formula and method, and <a target="_blank" rel="noopener" href="http://cs231n.github.io/neural-networks-3/">Stanford CS231n</a> for more training tips. In our example, the point-wise derivative for ReLu is: <a target="_blank" rel="noopener" href="http://www.parallelr.com/r-deep-neural-network-from-scratch/class-relu/"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/class.relu_.png" alt="class.relu"></a> R code:</p>
<p># Train: build and train a 2-layers neural network<br>train.dnn &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/function">function</a>(x, y, traindata=data, testdata=NULL,<br>                  # set hidden layers and neurons<br>                  # currently, only support 1 hidden layer<br>                  hidden=<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/c">c</a>(6),<br>                  # max iteration steps<br>                  maxit=2000,<br>                  # delta loss<br>                  abstol=1e-2,<br>                  # learning rate<br>                  lr = 1e-2,<br>                  # regularization rate<br>                  reg = 1e-3,<br>                  # show results every ‘display’ step<br>                  display = 100,<br>                  random.seed = 1)<br>{<br>  # to make the case reproducible.<br>  <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/set.seed">set.seed</a>(random.seed)<br> <br>  # total number of training set<br>  N &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>(traindata)<br> <br>  # extract the data and label<br>  # don’t need atribute<br>  X &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/unname">unname</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/data.matrix">data.matrix</a>(traindata[,x]))<br>  Y &lt;- traindata[,y]<br>  if(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/is.factor">is.factor</a>(Y)) { Y &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/as.integer">as.integer</a>(Y) }<br>  # updated: 10.March.2016: create index for both row and col<br>  Y.len   &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/length">length</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/unique">unique</a>(Y))<br>  Y.set   &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sort">sort</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/unique">unique</a>(Y))<br>  Y.index &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/cbind">cbind</a>(1:N, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/match">match</a>(Y, Y.set))<br> <br>  # number of input features<br>  D &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>(X)<br>  # number of categories for classification<br>  K &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/length">length</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/unique">unique</a>(Y))<br>  H &lt;-  hidden<br> <br>  # create and init weights and bias<br>  W1 &lt;- 0.01*<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/stats/rnorm">rnorm</a>(D*H), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=D, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=H)<br>  b1 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(0, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=1, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=H)<br> <br>  W2 &lt;- 0.01*<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/stats/rnorm">rnorm</a>(H*K), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=H, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=K)<br>  b2 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/matrix">matrix</a>(0, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/nrow">nrow</a>=1, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/ncol">ncol</a>=K)<br> <br>  # use all train data to update weights since it’s a small dataset<br>  batchsize &lt;- N<br>  # updated: March 17. 2016<br>  # init loss to a very big value<br>  loss &lt;- 100000<br> <br>  # Training the network<br>  i &lt;- 0<br>  while(i &lt; maxit &amp;&amp; loss &gt; abstol ) {<br> <br>    # iteration index<br>    i &lt;- i +1<br> <br>    # forward ….<br>    # 1 indicate row, 2 indicate col<br>    hidden.layer &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(X %<em>% W1 ,2, b1, ‘+’)<br>    # neurons : ReLU<br>    hidden.layer &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/pmax">pmax</a>(hidden.layer, 0)<br>    score &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(hidden.layer %</em>% W2, 2, b2, ‘+’)<br> <br>    # softmax<br>    score.exp &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/exp">exp</a>(score)<br>    probs &lt;-<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sweep">sweep</a>(score.exp, 1, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rowSums">rowSums</a>(score.exp), ‘/‘)<br> <br>    # compute the loss<br>    corect.logprobs &lt;- -<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/log">log</a>(probs[Y.index])<br>    data.loss  &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sum">sum</a>(corect.logprobs)/batchsize<br>    reg.loss   &lt;- 0.5*reg* (<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sum">sum</a>(W1<em>W1) + <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sum">sum</a>(W2</em>W2))<br>    loss &lt;- data.loss + reg.loss<br> <br>    # display results and update model<br>    if( i %% display == 0) {<br>        if(<img src="http://inside-r.org/r-doc/base/is.null" alt="is.null">(testdata)) {<br>            model &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/list">list</a>( D = D,<br>                           H = H,<br>                           K = K,<br>                           # weights and bias<br>                           W1 = W1,<br>                           b1 = b1,<br>                           W2 = W2,<br>                           b2 = b2)<br>            labs &lt;- predict.dnn(model, testdata[,-y])<br>            # updated: 10.March.2016<br>            accuracy &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/mean">mean</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/as.integer">as.integer</a>(testdata[,y]) == Y.set[labs])<br>            <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/cat">cat</a>(i, loss, accuracy, “\n”)<br>        } else {<br>            <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/cat">cat</a>(i, loss, “\n”)<br>        }<br>    }<br> <br>    # backward ….<br>    dscores &lt;- probs<br>    dscores[Y.index] &lt;- dscores[Y.index] -1<br>    dscores &lt;- dscores / batchsize<br> <br> <br>    dW2 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/t">t</a>(hidden.layer) %<em>% dscores<br>    db2 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/colSums">colSums</a>(dscores)<br> <br>    dhidden &lt;- dscores %</em>% <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/t">t</a>(W2)<br>    dhidden[hidden.layer &lt;= 0] &lt;- 0<br> <br>    dW1 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/t">t</a>(X) %<em>% dhidden<br>    db1 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/colSums">colSums</a>(dhidden)<br> <br>    # update ….<br>    dW2 &lt;- dW2 + reg</em>W2<br>    dW1 &lt;- dW1  + reg*W1<br> <br>    W1 &lt;- W1 - lr * dW1<br>    b1 &lt;- b1 - lr * db1<br> <br>    W2 &lt;- W2 - lr * dW2<br>    b2 &lt;- b2 - lr * db2<br> <br>  }<br> <br>  # final results<br>  # creat list to store learned parameters<br>  # you can add more parameters for debug and visualization<br>  # such as residuals, fitted.values …<br>  model &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/list">list</a>( D = D,<br>                 H = H,<br>                 K = K,<br>                 # weights and bias<br>                 W1= W1,<br>                 b1= b1,<br>                 W2= W2,<br>                 b2= b2)<br> <br>  <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/return">return</a>(model)<br>}</p>
<p> </p>
<h2 id="Testing-and-Visualization"><a href="#Testing-and-Visualization" class="headerlink" title="Testing and Visualization"></a>Testing and Visualization</h2><p>We have built the simple 2-layers DNN model and now we can test our model. First, the dataset is split into two parts for training and testing, and then use the training set to train model while testing set to measure the generalization ability of our model. R code</p>
<p>########################################################################<br># testing<br>#######################################################################<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/set.seed">set.seed</a>(1)<br> <br># 0. EDA<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/summary">summary</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>)<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/graphics/plot">plot</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>)<br> <br># 1. split data into test/train<br>samp &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/c">c</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sample">sample</a>(1:50,25), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sample">sample</a>(51:100,25), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/sample">sample</a>(101:150,25))<br> <br># 2. train model<br>ir.model &lt;- train.dnn(x=1:4, y=5, traindata=<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>[samp,], testdata=<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>[-samp,], hidden=6, maxit=2000, display=50)<br> <br># 3. prediction<br>labels.dnn &lt;- predict.dnn(ir.model, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>[-samp, -5])<br> <br># 4. verify the results<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/table">table</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>[-samp,5], labels.dnn)<br>#          labels.dnn<br>#            1  2  3<br>#setosa     25  0  0<br>#versicolor  0 24  1<br>#virginica   0  0 25<br> <br>#accuracy<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/mean">mean</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/as.integer">as.integer</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris">iris</a>[-samp, 5]) == labels.dnn)<br># 0.98</p>
<p>The data loss in train set and the accuracy in test as below: <a target="_blank" rel="noopener" href="http://www.parallelr.com/r-deep-neural-network-from-scratch/iris_loss_accuracy-2/"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/iris_loss_accuracy-1.png"></a> Then we compare our DNN model with ‘nnet’ package as below codes.</p>
<p><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/library">library</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/nnet/nnet">nnet</a>)<br>ird &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/data.frame">data.frame</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rbind">rbind</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris3">iris3</a>[,,1], <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris3">iris3</a>[,,2], <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/datasets/iris3">iris3</a>[,,3]),<br>                  species = <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/factor">factor</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/c">c</a>(<a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rep">rep</a>(“s”,50), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rep">rep</a>(“c”, 50), <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/rep">rep</a>(“v”, 50))))<br>ir.nn2 &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/nnet/nnet">nnet</a>(species ~ ., <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/utils/data">data</a> = ird, <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/subset">subset</a> = samp, size = 6, rang = 0.1,<br>               decay = 1e-2, maxit = 2000)<br> <br>labels.nnet &lt;- <a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/stats/predict">predict</a>(ir.nn2, ird[-samp,], type=”class”)<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/table">table</a>(ird$species[-samp], labels.nnet)<br>#  labels.nnet<br>#   c  s  v<br>#c 22  0  3<br>#s  0 25  0<br>#v  3  0 22<br> <br># accuracy<br><a target="_blank" rel="noopener" href="http://inside-r.org/r-doc/base/mean">mean</a>(ird$species[-samp] == labels.nnet)<br># 0.96 </p>
<p><strong>Update: 4/28/2016:</strong> Google’s tensorflow released a very cool website to visualize neural network in <a target="_blank" rel="noopener" href="http://playground.tensorflow.org/">here</a>. And we has taught almost all technologies as google’s website in this blog so you can build up with R as well :) <a target="_blank" rel="noopener" href="http://playground.tensorflow.org/#activation=tanh&batchSize=10&dataset=circle&regDataset=reg-plane&learningRate=0.03&regularizationRate=0&noise=0&networkShape=4,2&seed=0.86675&showTestData=false&discretize=false&percTrainData=50&x=true&y=true&xTimesY=false&xSquared=false&ySquared=false&cosX=false&sinX=false&cosY=false&sinY=false&collectStats=false&problem=classification"><img src="http://www.parallelr.com/wp-content/uploads/2016/02/tensorflow.png" alt="tensorflow"></a>  </p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>In this post, we have shown how to implement R neural network from scratch. But the code is only implemented the core concepts of DNN, and the reader can do further practices by:</p>
<ul>
<li>  Solving other classification problem, such as a toy case in <a target="_blank" rel="noopener" href="http://www.wildml.com/2015/09/implementing-a-neural-network-from-scratch/">here</a></li>
<li>  Selecting various hidden layer size, activation function, loss function</li>
<li>  Extending single hidden layer network to multi-hidden layers</li>
<li>  Adjusting the network to resolve regression problems</li>
<li>  Visualizing the network architecture, weights, and bias by R, an example in <a target="_blank" rel="noopener" href="https://beckmw.wordpress.com/tag/nnet/">here</a>.</li>
</ul>
<p><strong>In the next <a target="_blank" rel="noopener" href="http://www.parallelr.com/r-dnn-parallel-acceleration/">post</a>, I will introduce how to accelerate this code by multicores CPU and NVIDIA GPU.</strong></p>
<hr>
<p>Notes: 1. The entire source code of this post in <a target="_blank" rel="noopener" href="https://github.com/PatricZhao/ParallelR/blob/master/ParDNN/iris_dnn.R">here</a> 2. The PDF version of this post in <a target="_blank" rel="noopener" href="http://www.parallelr.com/materials/2_DNN/ParallelR_R_DNN_1_BUILD_FROM_SCRATCH.pdf">here</a> 3. Pretty R syntax in this blog is <a target="_blank" rel="noopener" href="http://blog.revolutionanalytics.com/2016/08/farewell-inside-rorg.html" title="Created by Pretty R at inside-R.org">Created by inside-R .org</a> (acquired by MS and dead)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jitmatrix.github.io/oneXPU/2016/02/13/r-deep-neural-network-from-scratch/" data-id="ckivbxbj30067zroec32zhl9o" data-title="R for Deep Learning (I):  Build Fully Connected Neural Network from Scratch" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/R/" rel="tag">R</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/big-data/" rel="tag">big data</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/data-analytics/" rel="tag">data analytics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/deep-learning/" rel="tag">deep learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/dnn/" rel="tag">dnn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/iris/" rel="tag">iris</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/machine-learning/" rel="tag">machine learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/neural-network/" rel="tag">neural network</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/oneXPU/tags/rstats/" rel="tag">rstats</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/oneXPU/2016/03/08/r-dnn-parallel-acceleration/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          R for Deep Learning (II): Achieve High-Performance DNN with Parallel Acceleration
        
      </div>
    </a>
  
  
    <a href="/oneXPU/2016/02/02/the-r-parallel-programming-blog/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">The R Parallel Programming Blog</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/">Accelerators</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/GPGPU/">GPGPU</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/GPGPU/MultiCores/">MultiCores</a></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/GPGPU/Performance-Optimizaiton/">Performance Optimizaiton</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/">General</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/GPGPU/">GPGPU</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/GPGPU/MultiCores/">MultiCores</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/GPGPU/MultiCores/Performance-Optimizaiton/">Performance Optimizaiton</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/MPI/">MPI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/MPI/MultiCores/">MultiCores</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/MPI/MultiCores/Performance-Optimizaiton/">Performance Optimizaiton</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/General/MPI/MultiCores/Performance-Optimizaiton/Vectorization/">Vectorization</a></li></ul></li></ul></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/MultiCores/">MultiCores</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/MultiCores/Performance-Optimizaiton/">Performance Optimizaiton</a></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/Accelerators/MultiCores/Vectorization/">Vectorization</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/GPGPU/">GPGPU</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/GPGPU/Intel-Xeon-Phi/">Intel Xeon Phi</a></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/GPGPU/MultiCores/">MultiCores</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/GPGPU/MultiCores/Performance-Optimizaiton/">Performance Optimizaiton</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/General/">General</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/oneXPU/categories/General/MultiCores/">MultiCores</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/BLAS/" rel="tag">BLAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/CRAN/" rel="tag">CRAN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/CUDA/" rel="tag">CUDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/GEMM/" rel="tag">GEMM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/GPU/" rel="tag">GPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/H2O/" rel="tag">H2O</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/HPAC/" rel="tag">HPAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/HPC/" rel="tag">HPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/MIC/" rel="tag">MIC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/MKL/" rel="tag">MKL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/MNIST/" rel="tag">MNIST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/Maximum-Likelihood/" rel="tag">Maximum Likelihood</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/R/" rel="tag">R</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/Rcpp/" rel="tag">Rcpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/SSE/" rel="tag">SSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/Xeon/" rel="tag">Xeon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/Xeon-Phi/" rel="tag">Xeon Phi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/benchmark/" rel="tag">benchmark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/big-data/" rel="tag">big data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/boost/" rel="tag">boost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/classification/" rel="tag">classification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/cuBLAS/" rel="tag">cuBLAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/data-analytics/" rel="tag">data analytics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/deep-learning/" rel="tag">deep learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/dnn/" rel="tag">dnn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/doMC/" rel="tag">doMC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/doParallel/" rel="tag">doParallel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/foreach/" rel="tag">foreach</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/gmatrix/" rel="tag">gmatrix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/gpuR/" rel="tag">gpuR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/gputools/" rel="tag">gputools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/high-performance/" rel="tag">high performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/iris/" rel="tag">iris</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/knn/" rel="tag">knn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/lightboost/" rel="tag">lightboost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/machine-learing/" rel="tag">machine learing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/machine-learning/" rel="tag">machine learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/mcapply/" rel="tag">mcapply</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/memory-usage/" rel="tag">memory usage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/multicores/" rel="tag">multicores</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/multit/" rel="tag">multit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/multithreads/" rel="tag">multithreads</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/mutlithreading/" rel="tag">mutlithreading</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/mutltiGPU/" rel="tag">mutltiGPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/neural-network/" rel="tag">neural network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/nvblas/" rel="tag">nvblas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/openMP/" rel="tag">openMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/openblas/" rel="tag">openblas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/parallel/" rel="tag">parallel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/parallel-computing/" rel="tag">parallel computing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/parlapply/" rel="tag">parlapply</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/performance-optimization/" rel="tag">performance optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/profiling/" rel="tag">profiling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/rstats/" rel="tag">rstats</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/sklearn/" rel="tag">sklearn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/snow/" rel="tag">snow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/oneXPU/tags/xgboost/" rel="tag">xgboost</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/oneXPU/tags/BLAS/" style="font-size: 10px;">BLAS</a> <a href="/oneXPU/tags/CRAN/" style="font-size: 10px;">CRAN</a> <a href="/oneXPU/tags/CUDA/" style="font-size: 12px;">CUDA</a> <a href="/oneXPU/tags/GEMM/" style="font-size: 12px;">GEMM</a> <a href="/oneXPU/tags/GPU/" style="font-size: 14px;">GPU</a> <a href="/oneXPU/tags/H2O/" style="font-size: 12px;">H2O</a> <a href="/oneXPU/tags/HPAC/" style="font-size: 10px;">HPAC</a> <a href="/oneXPU/tags/HPC/" style="font-size: 12px;">HPC</a> <a href="/oneXPU/tags/MIC/" style="font-size: 10px;">MIC</a> <a href="/oneXPU/tags/MKL/" style="font-size: 14px;">MKL</a> <a href="/oneXPU/tags/MNIST/" style="font-size: 10px;">MNIST</a> <a href="/oneXPU/tags/Maximum-Likelihood/" style="font-size: 10px;">Maximum Likelihood</a> <a href="/oneXPU/tags/R/" style="font-size: 20px;">R</a> <a href="/oneXPU/tags/Rcpp/" style="font-size: 10px;">Rcpp</a> <a href="/oneXPU/tags/SSE/" style="font-size: 10px;">SSE</a> <a href="/oneXPU/tags/Xeon/" style="font-size: 10px;">Xeon</a> <a href="/oneXPU/tags/Xeon-Phi/" style="font-size: 10px;">Xeon Phi</a> <a href="/oneXPU/tags/benchmark/" style="font-size: 10px;">benchmark</a> <a href="/oneXPU/tags/big-data/" style="font-size: 10px;">big data</a> <a href="/oneXPU/tags/boost/" style="font-size: 10px;">boost</a> <a href="/oneXPU/tags/classification/" style="font-size: 10px;">classification</a> <a href="/oneXPU/tags/cuBLAS/" style="font-size: 16px;">cuBLAS</a> <a href="/oneXPU/tags/data-analytics/" style="font-size: 12px;">data analytics</a> <a href="/oneXPU/tags/deep-learning/" style="font-size: 14px;">deep learning</a> <a href="/oneXPU/tags/dnn/" style="font-size: 12px;">dnn</a> <a href="/oneXPU/tags/doMC/" style="font-size: 10px;">doMC</a> <a href="/oneXPU/tags/doParallel/" style="font-size: 10px;">doParallel</a> <a href="/oneXPU/tags/foreach/" style="font-size: 10px;">foreach</a> <a href="/oneXPU/tags/gmatrix/" style="font-size: 10px;">gmatrix</a> <a href="/oneXPU/tags/gpuR/" style="font-size: 10px;">gpuR</a> <a href="/oneXPU/tags/gputools/" style="font-size: 10px;">gputools</a> <a href="/oneXPU/tags/high-performance/" style="font-size: 10px;">high performance</a> <a href="/oneXPU/tags/iris/" style="font-size: 10px;">iris</a> <a href="/oneXPU/tags/knn/" style="font-size: 10px;">knn</a> <a href="/oneXPU/tags/lightboost/" style="font-size: 10px;">lightboost</a> <a href="/oneXPU/tags/machine-learing/" style="font-size: 10px;">machine learing</a> <a href="/oneXPU/tags/machine-learning/" style="font-size: 12px;">machine learning</a> <a href="/oneXPU/tags/mcapply/" style="font-size: 10px;">mcapply</a> <a href="/oneXPU/tags/memory-usage/" style="font-size: 10px;">memory usage</a> <a href="/oneXPU/tags/multicores/" style="font-size: 18px;">multicores</a> <a href="/oneXPU/tags/multit/" style="font-size: 10px;">multit</a> <a href="/oneXPU/tags/multithreads/" style="font-size: 10px;">multithreads</a> <a href="/oneXPU/tags/mutlithreading/" style="font-size: 10px;">mutlithreading</a> <a href="/oneXPU/tags/mutltiGPU/" style="font-size: 10px;">mutltiGPU</a> <a href="/oneXPU/tags/neural-network/" style="font-size: 10px;">neural network</a> <a href="/oneXPU/tags/nvblas/" style="font-size: 10px;">nvblas</a> <a href="/oneXPU/tags/openMP/" style="font-size: 12px;">openMP</a> <a href="/oneXPU/tags/openblas/" style="font-size: 12px;">openblas</a> <a href="/oneXPU/tags/parallel/" style="font-size: 10px;">parallel</a> <a href="/oneXPU/tags/parallel-computing/" style="font-size: 18px;">parallel computing</a> <a href="/oneXPU/tags/parlapply/" style="font-size: 10px;">parlapply</a> <a href="/oneXPU/tags/performance-optimization/" style="font-size: 16px;">performance optimization</a> <a href="/oneXPU/tags/profiling/" style="font-size: 12px;">profiling</a> <a href="/oneXPU/tags/python/" style="font-size: 10px;">python</a> <a href="/oneXPU/tags/rstats/" style="font-size: 20px;">rstats</a> <a href="/oneXPU/tags/sklearn/" style="font-size: 10px;">sklearn</a> <a href="/oneXPU/tags/snow/" style="font-size: 10px;">snow</a> <a href="/oneXPU/tags/xgboost/" style="font-size: 10px;">xgboost</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/oneXPU/archives/2016/02/">February 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/oneXPU/2017/04/07/r-hpac-benchmark-analysis-gpu/">R benchmark for High-Performance Analytics and Computing (II): GPU Packages</a>
          </li>
        
          <li>
            <a href="/oneXPU/2017/01/24/parallel-computation-with-r-and-xgboost/">Parallel Computation with R and XGBoost</a>
          </li>
        
          <li>
            <a href="/oneXPU/2016/09/10/r-with-parallel-computing/">R with Parallel Computing from User Perspectives</a>
          </li>
        
          <li>
            <a href="/oneXPU/2016/08/15/r-cran-package-modernization-openmp/">R and OpenMP:  CRAN Package Modernization</a>
          </li>
        
          <li>
            <a href="/oneXPU/2016/07/26/r-and-openmp-boosting-compiled-code-on-multi-core-cpu-s/">R and openMP: boosting compiled code on multi-core cpu-s</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2020 Patric Zhao<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/oneXPU/" class="mobile-nav-link">Home</a>
  
    <a href="/oneXPU/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/oneXPU/js/jquery-3.4.1.min.js"></script>



  
<script src="/oneXPU/fancybox/jquery.fancybox.min.js"></script>




<script src="/oneXPU/js/script.js"></script>





  </div>
</body>
</html>